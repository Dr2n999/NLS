<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Evaluation of the custom code | Non-linear regression</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
set in the _output.yml file.
The HTML output format for this example is bookdown::gitbook,</p>" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Evaluation of the custom code | Non-linear regression" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
set in the _output.yml file.
The HTML output format for this example is bookdown::gitbook,</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Evaluation of the custom code | Non-linear regression" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
set in the _output.yml file.
The HTML output format for this example is bookdown::gitbook,</p>" />
  

<meta name="author" content="Kyungmin In, GCCL" />


<meta name="date" content="2025-04-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="applying-the-lm-algorithm-to-lba-data.html"/>
<link rel="next" href="closing-remarks.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Non-linear regression</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Non-Linear Regression and Optimization Methods in LBA Data Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#key-optimization-methods-in-non-linear-regression"><i class="fa fa-check"></i>Key Optimization Methods in Non-Linear Regression</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-levenberg-marquardt-algorithm-a-hybrid-approach"><i class="fa fa-check"></i>The Levenberg-Marquardt Algorithm: A Hybrid Approach</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-should-we-care-about-these-optimization-methods"><i class="fa fa-check"></i>Why Should We Care About These Optimization Methods?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#practical-implementation-in-r"><i class="fa fa-check"></i>Practical Implementation in R</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>Author</a></li>
<li class="chapter" data-level="1" data-path="the-gradient-descent-method.html"><a href="the-gradient-descent-method.html"><i class="fa fa-check"></i><b>1</b> The Gradient descent method</a>
<ul>
<li class="chapter" data-level="1.1" data-path="the-gradient-descent-method.html"><a href="the-gradient-descent-method.html#computation-of-the-chi-squared-function"><i class="fa fa-check"></i><b>1.1</b> Computation of the chi-squared function</a></li>
<li class="chapter" data-level="1.2" data-path="the-gradient-descent-method.html"><a href="the-gradient-descent-method.html#computation-of-the-gradient"><i class="fa fa-check"></i><b>1.2</b> Computation of the gradient</a></li>
<li class="chapter" data-level="1.3" data-path="the-gradient-descent-method.html"><a href="the-gradient-descent-method.html#the-parameter-updating"><i class="fa fa-check"></i><b>1.3</b> The parameter updating</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-gauss-newton-method.html"><a href="the-gauss-newton-method.html"><i class="fa fa-check"></i><b>2</b> The Gauss-Newton Method</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-gauss-newton-method.html"><a href="the-gauss-newton-method.html#computation-of-the-chi-squared-function-1"><i class="fa fa-check"></i><b>2.1</b> Computation of the chi-squared function</a></li>
<li class="chapter" data-level="2.2" data-path="the-gauss-newton-method.html"><a href="the-gauss-newton-method.html#computation-of-the-gradient-1"><i class="fa fa-check"></i><b>2.2</b> Computation of the gradient</a></li>
<li class="chapter" data-level="2.3" data-path="the-gauss-newton-method.html"><a href="the-gauss-newton-method.html#the-parameter-updating-1"><i class="fa fa-check"></i><b>2.3</b> The parameter updating</a></li>
<li class="chapter" data-level="2.4" data-path="the-gauss-newton-method.html"><a href="the-gauss-newton-method.html#summary-and-comparison-to-gradient-descent"><i class="fa fa-check"></i><b>2.4</b> Summary and Comparison to Gradient Descent</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="levenberg-marquardt-lm-algorithm.html"><a href="levenberg-marquardt-lm-algorithm.html"><i class="fa fa-check"></i><b>3</b> Levenberg-Marquardt (LM) algorithm</a>
<ul>
<li class="chapter" data-level="3.1" data-path="levenberg-marquardt-lm-algorithm.html"><a href="levenberg-marquardt-lm-algorithm.html#the-damping-factor-lambda"><i class="fa fa-check"></i><b>3.1</b> The Damping Factor <span class="math inline">\(\lambda\)</span></a></li>
<li class="chapter" data-level="3.2" data-path="levenberg-marquardt-lm-algorithm.html"><a href="levenberg-marquardt-lm-algorithm.html#advantages-of-the-lm-algorithm"><i class="fa fa-check"></i><b>3.2</b> Advantages of the LM Algorithm</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="applying-the-lm-algorithm-to-a-damped-oscillation-model.html"><a href="applying-the-lm-algorithm-to-a-damped-oscillation-model.html"><i class="fa fa-check"></i><b>4</b> Applying the LM Algorithm to a Damped Oscillation Model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="applying-the-lm-algorithm-to-a-damped-oscillation-model.html"><a href="applying-the-lm-algorithm-to-a-damped-oscillation-model.html#example-data"><i class="fa fa-check"></i><b>4.1</b> Example Data</a></li>
<li class="chapter" data-level="4.2" data-path="applying-the-lm-algorithm-to-a-damped-oscillation-model.html"><a href="applying-the-lm-algorithm-to-a-damped-oscillation-model.html#data-fitting-using-nlslm"><i class="fa fa-check"></i><b>4.2</b> Data fitting using nlsLM</a></li>
<li class="chapter" data-level="4.3" data-path="applying-the-lm-algorithm-to-a-damped-oscillation-model.html"><a href="applying-the-lm-algorithm-to-a-damped-oscillation-model.html#how-the-algorithm-works"><i class="fa fa-check"></i><b>4.3</b> How the Algorithm Works</a></li>
<li class="chapter" data-level="4.4" data-path="applying-the-lm-algorithm-to-a-damped-oscillation-model.html"><a href="applying-the-lm-algorithm-to-a-damped-oscillation-model.html#custom-implementation-of-the-algorithm"><i class="fa fa-check"></i><b>4.4</b> Custom Implementation of the Algorithm</a></li>
<li class="chapter" data-level="4.5" data-path="applying-the-lm-algorithm-to-a-damped-oscillation-model.html"><a href="applying-the-lm-algorithm-to-a-damped-oscillation-model.html#convergence-criteria-of-the-algorithm"><i class="fa fa-check"></i><b>4.5</b> Convergence Criteria of the Algorithm</a></li>
<li class="chapter" data-level="4.6" data-path="applying-the-lm-algorithm-to-a-damped-oscillation-model.html"><a href="applying-the-lm-algorithm-to-a-damped-oscillation-model.html#code-example"><i class="fa fa-check"></i><b>4.6</b> Code Example</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="applying-the-algorithm-to-a-sphere-function-model.html"><a href="applying-the-algorithm-to-a-sphere-function-model.html"><i class="fa fa-check"></i><b>5</b> Applying the Algorithm to a Sphere function model</a>
<ul>
<li class="chapter" data-level="5.1" data-path="applying-the-algorithm-to-a-sphere-function-model.html"><a href="applying-the-algorithm-to-a-sphere-function-model.html#code-explanation"><i class="fa fa-check"></i><b>5.1</b> Code Explanation</a></li>
<li class="chapter" data-level="5.2" data-path="applying-the-algorithm-to-a-sphere-function-model.html"><a href="applying-the-algorithm-to-a-sphere-function-model.html#example-data-1"><i class="fa fa-check"></i><b>5.2</b> Example data</a></li>
<li class="chapter" data-level="5.3" data-path="applying-the-algorithm-to-a-sphere-function-model.html"><a href="applying-the-algorithm-to-a-sphere-function-model.html#optimization-with-the-algorithm"><i class="fa fa-check"></i><b>5.3</b> Optimization with the Algorithm</a></li>
<li class="chapter" data-level="5.4" data-path="applying-the-algorithm-to-a-sphere-function-model.html"><a href="applying-the-algorithm-to-a-sphere-function-model.html#applying-the-algorithm"><i class="fa fa-check"></i><b>5.4</b> Applying the Algorithm</a></li>
<li class="chapter" data-level="5.5" data-path="applying-the-algorithm-to-a-sphere-function-model.html"><a href="applying-the-algorithm-to-a-sphere-function-model.html#code-example-1"><i class="fa fa-check"></i><b>5.5</b> Code Example</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="applying-the-lm-algorithm-to-lba-data.html"><a href="applying-the-lm-algorithm-to-lba-data.html"><i class="fa fa-check"></i><b>6</b> Applying the LM Algorithm to LBA data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="applying-the-lm-algorithm-to-lba-data.html"><a href="applying-the-lm-algorithm-to-lba-data.html#pl-curve"><i class="fa fa-check"></i><b>6.1</b> 5 PL curve</a></li>
<li class="chapter" data-level="6.2" data-path="applying-the-lm-algorithm-to-lba-data.html"><a href="applying-the-lm-algorithm-to-lba-data.html#data-set"><i class="fa fa-check"></i><b>6.2</b> Data set</a></li>
<li class="chapter" data-level="6.3" data-path="applying-the-lm-algorithm-to-lba-data.html"><a href="applying-the-lm-algorithm-to-lba-data.html#initial-parameter-estimation"><i class="fa fa-check"></i><b>6.3</b> Initial parameter estimation</a></li>
<li class="chapter" data-level="6.4" data-path="applying-the-lm-algorithm-to-lba-data.html"><a href="applying-the-lm-algorithm-to-lba-data.html#example-of-code"><i class="fa fa-check"></i><b>6.4</b> Example of Code</a></li>
<li class="chapter" data-level="6.5" data-path="applying-the-lm-algorithm-to-lba-data.html"><a href="applying-the-lm-algorithm-to-lba-data.html#visualization-of-the-fitting-process"><i class="fa fa-check"></i><b>6.5</b> Visualization of the fitting process</a></li>
<li class="chapter" data-level="6.6" data-path="applying-the-lm-algorithm-to-lba-data.html"><a href="applying-the-lm-algorithm-to-lba-data.html#result"><i class="fa fa-check"></i><b>6.6</b> Result</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="evaluation-of-the-custom-code.html"><a href="evaluation-of-the-custom-code.html"><i class="fa fa-check"></i><b>7</b> Evaluation of the custom code</a></li>
<li class="chapter" data-level="" data-path="closing-remarks.html"><a href="closing-remarks.html"><i class="fa fa-check"></i>Closing Remarks</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Non-linear regression</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="evaluation-of-the-custom-code" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Evaluation of the custom code<a href="evaluation-of-the-custom-code.html#evaluation-of-the-custom-code" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>From a practical perspective, it makes sense to compare both functions (<code>nlsLM</code> and the custom code) to ensure that the custom code works properly for the calibration curve fitting because the estimated parameters might not be identical due to the inherent characteristic of this optimization algorithm since it aims to find <strong>local minima</strong> rather than <strong>a global minimum</strong>. Therefore, the direct comparison of the parameters is not practical and that also may lead to inappropriate interpretations. For those reasons, we’ll apply more intuitive method based on the general principle and practice of the analytical method validation.</p>
<p>First, we’ll optimize parameters of each run using my code and <code>nlsLM</code>, independently. Next, using the parameters we’ll compute back-calculated concentrations of each calibration standard to evaluate <strong>accuracy</strong> of those. The accuracy can be expressed and measured by %Bias such as:</p>
<p><span class="math display">\[
\text{%Bias} =\frac{\text{(Back-calculated Concentration - Nominal Concentration)}}{\text{Nomincal Concentration}} \cdot 100
\]</span></p>
<p>Second, we’ll plot the %Bias result so can compare those <strong>visually</strong>. In most of cases, the acceptable accuracy range for LLOQ and ULOQ calibration standard is <span class="math inline">\(\pm\)</span> 25 %Bis, and <span class="math inline">\(\pm\)</span> 20 %Bias for the others. These do not usually apply to anchor point(s), but this time we’ll do to compare the %Bias of all calibration standards, to check how they differ, and to determine if the differences are within the acceptance criteria for accuracy, despite any discrepancies. In my experience, it is a good practice to evaluate results carefully, as not all commercial analytical software provides the same level of transparency. This is particularly important when using different software, since users cannot always be sure of the algorithms being used or whether there are differences in certain aspects, even when the same algorithm is applied.</p>
<hr />
<p>Here’s an example code. By running this code, we can obtain optimized parameter from each run, which are estimated by my code and save them as result for %Bias calculation.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="evaluation-of-the-custom-code.html#cb38-1" tabindex="-1"></a>LM.custom <span class="ot">&lt;-</span> <span class="cf">function</span>(w0, data, run) {</span>
<span id="cb38-2"><a href="evaluation-of-the-custom-code.html#cb38-2" tabindex="-1"></a>  w <span class="ot">&lt;-</span>  w.previous <span class="ot">&lt;-</span> w0</span>
<span id="cb38-3"><a href="evaluation-of-the-custom-code.html#cb38-3" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span>  </span>
<span id="cb38-4"><a href="evaluation-of-the-custom-code.html#cb38-4" tabindex="-1"></a>  feval <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb38-5"><a href="evaluation-of-the-custom-code.html#cb38-5" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fl">1e-2</span>  </span>
<span id="cb38-6"><a href="evaluation-of-the-custom-code.html#cb38-6" tabindex="-1"></a>  ftol <span class="ot">&lt;-</span> <span class="fl">1e-6</span></span>
<span id="cb38-7"><a href="evaluation-of-the-custom-code.html#cb38-7" tabindex="-1"></a>  ptol <span class="ot">&lt;-</span> <span class="fl">1e-6</span></span>
<span id="cb38-8"><a href="evaluation-of-the-custom-code.html#cb38-8" tabindex="-1"></a>  gtol <span class="ot">&lt;-</span> <span class="dv">0</span>  </span>
<span id="cb38-9"><a href="evaluation-of-the-custom-code.html#cb38-9" tabindex="-1"></a>  maxiter <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb38-10"><a href="evaluation-of-the-custom-code.html#cb38-10" tabindex="-1"></a>  maxfev <span class="ot">&lt;-</span> <span class="dv">600</span></span>
<span id="cb38-11"><a href="evaluation-of-the-custom-code.html#cb38-11" tabindex="-1"></a>  </span>
<span id="cb38-12"><a href="evaluation-of-the-custom-code.html#cb38-12" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>od[data<span class="sc">$</span>run <span class="sc">==</span> run]</span>
<span id="cb38-13"><a href="evaluation-of-the-custom-code.html#cb38-13" tabindex="-1"></a>  x_data <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>conc)</span>
<span id="cb38-14"><a href="evaluation-of-the-custom-code.html#cb38-14" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x_data)</span>
<span id="cb38-15"><a href="evaluation-of-the-custom-code.html#cb38-15" tabindex="-1"></a>  x_rep <span class="ot">&lt;-</span> <span class="fu">rep</span>(x_data, <span class="dv">2</span>)</span>
<span id="cb38-16"><a href="evaluation-of-the-custom-code.html#cb38-16" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">unique</span>(data<span class="sc">$</span>conc), <span class="at">od =</span> y)</span>
<span id="cb38-17"><a href="evaluation-of-the-custom-code.html#cb38-17" tabindex="-1"></a>  </span>
<span id="cb38-18"><a href="evaluation-of-the-custom-code.html#cb38-18" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="cf">function</span>(w0) {</span>
<span id="cb38-19"><a href="evaluation-of-the-custom-code.html#cb38-19" tabindex="-1"></a>    model <span class="ot">&lt;-</span> w0[<span class="dv">1</span>] <span class="sc">+</span> (w0[<span class="dv">4</span>] <span class="sc">-</span> w0[<span class="dv">1</span>]) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> (x_rep <span class="sc">/</span> w0[<span class="dv">3</span>])<span class="sc">^</span>w0[<span class="dv">2</span>])<span class="sc">^</span>w0[<span class="dv">5</span>]</span>
<span id="cb38-20"><a href="evaluation-of-the-custom-code.html#cb38-20" tabindex="-1"></a>    <span class="fu">return</span>(model)</span>
<span id="cb38-21"><a href="evaluation-of-the-custom-code.html#cb38-21" tabindex="-1"></a>  }</span>
<span id="cb38-22"><a href="evaluation-of-the-custom-code.html#cb38-22" tabindex="-1"></a></span>
<span id="cb38-23"><a href="evaluation-of-the-custom-code.html#cb38-23" tabindex="-1"></a>  model.fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x, a, b, c, d, e) {</span>
<span id="cb38-24"><a href="evaluation-of-the-custom-code.html#cb38-24" tabindex="-1"></a>    a <span class="sc">+</span> (d <span class="sc">-</span> a) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> (x <span class="sc">/</span> c)<span class="sc">^</span>b)<span class="sc">^</span>e</span>
<span id="cb38-25"><a href="evaluation-of-the-custom-code.html#cb38-25" tabindex="-1"></a>  }</span>
<span id="cb38-26"><a href="evaluation-of-the-custom-code.html#cb38-26" tabindex="-1"></a></span>
<span id="cb38-27"><a href="evaluation-of-the-custom-code.html#cb38-27" tabindex="-1"></a>  chi.squre.fn <span class="ot">&lt;-</span> <span class="cf">function</span>(w) {</span>
<span id="cb38-28"><a href="evaluation-of-the-custom-code.html#cb38-28" tabindex="-1"></a>    chi.sq <span class="ot">&lt;-</span> <span class="fu">sum</span>((y <span class="sc">-</span> <span class="fu">f</span>(w))<span class="sc">^</span><span class="dv">2</span>)  </span>
<span id="cb38-29"><a href="evaluation-of-the-custom-code.html#cb38-29" tabindex="-1"></a>    <span class="fu">return</span>(chi.sq)</span>
<span id="cb38-30"><a href="evaluation-of-the-custom-code.html#cb38-30" tabindex="-1"></a>  }</span>
<span id="cb38-31"><a href="evaluation-of-the-custom-code.html#cb38-31" tabindex="-1"></a>  </span>
<span id="cb38-32"><a href="evaluation-of-the-custom-code.html#cb38-32" tabindex="-1"></a>  norm.fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb38-33"><a href="evaluation-of-the-custom-code.html#cb38-33" tabindex="-1"></a>  initial.chisq <span class="ot">&lt;-</span> previous.chisq <span class="ot">&lt;-</span> <span class="fu">chi.squre.fn</span>(w)</span>
<span id="cb38-34"><a href="evaluation-of-the-custom-code.html#cb38-34" tabindex="-1"></a></span>
<span id="cb38-35"><a href="evaluation-of-the-custom-code.html#cb38-35" tabindex="-1"></a>  calculate.cosine.angles <span class="ot">&lt;-</span> <span class="cf">function</span>(y, w) {</span>
<span id="cb38-36"><a href="evaluation-of-the-custom-code.html#cb38-36" tabindex="-1"></a>    r <span class="ot">&lt;-</span> y <span class="sc">-</span> <span class="fu">f</span>(w)  </span>
<span id="cb38-37"><a href="evaluation-of-the-custom-code.html#cb38-37" tabindex="-1"></a>    J <span class="ot">&lt;-</span> numDeriv<span class="sc">::</span><span class="fu">jacobian</span>(f, w)  </span>
<span id="cb38-38"><a href="evaluation-of-the-custom-code.html#cb38-38" tabindex="-1"></a>    norm.r <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(r<span class="sc">^</span><span class="dv">2</span>))  </span>
<span id="cb38-39"><a href="evaluation-of-the-custom-code.html#cb38-39" tabindex="-1"></a>    cosine.angles <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">ncol</span>(J))  </span>
<span id="cb38-40"><a href="evaluation-of-the-custom-code.html#cb38-40" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(J)) {</span>
<span id="cb38-41"><a href="evaluation-of-the-custom-code.html#cb38-41" tabindex="-1"></a>      J.col <span class="ot">&lt;-</span> J[, i]  </span>
<span id="cb38-42"><a href="evaluation-of-the-custom-code.html#cb38-42" tabindex="-1"></a>      norm.J.col <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(J.col<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb38-43"><a href="evaluation-of-the-custom-code.html#cb38-43" tabindex="-1"></a>      dot.product <span class="ot">&lt;-</span> <span class="fu">sum</span>(J.col <span class="sc">*</span> r)</span>
<span id="cb38-44"><a href="evaluation-of-the-custom-code.html#cb38-44" tabindex="-1"></a>      cosine.angles[i] <span class="ot">&lt;-</span> dot.product <span class="sc">/</span> (norm.J.col <span class="sc">*</span> norm.r)</span>
<span id="cb38-45"><a href="evaluation-of-the-custom-code.html#cb38-45" tabindex="-1"></a>    }</span>
<span id="cb38-46"><a href="evaluation-of-the-custom-code.html#cb38-46" tabindex="-1"></a>    </span>
<span id="cb38-47"><a href="evaluation-of-the-custom-code.html#cb38-47" tabindex="-1"></a>    <span class="fu">return</span>(cosine.angles)</span>
<span id="cb38-48"><a href="evaluation-of-the-custom-code.html#cb38-48" tabindex="-1"></a>  }</span>
<span id="cb38-49"><a href="evaluation-of-the-custom-code.html#cb38-49" tabindex="-1"></a></span>
<span id="cb38-50"><a href="evaluation-of-the-custom-code.html#cb38-50" tabindex="-1"></a>  <span class="cf">while</span> (k <span class="sc">&lt;</span> maxiter <span class="sc">&amp;&amp;</span> feval <span class="sc">&lt;</span> maxfev) {</span>
<span id="cb38-51"><a href="evaluation-of-the-custom-code.html#cb38-51" tabindex="-1"></a>    J <span class="ot">&lt;-</span> numDeriv<span class="sc">::</span><span class="fu">jacobian</span>(f, w) </span>
<span id="cb38-52"><a href="evaluation-of-the-custom-code.html#cb38-52" tabindex="-1"></a>    r1 <span class="ot">&lt;-</span> y <span class="sc">-</span> <span class="fu">f</span>(w)  <span class="co">#</span></span>
<span id="cb38-53"><a href="evaluation-of-the-custom-code.html#cb38-53" tabindex="-1"></a>    Jr <span class="ot">&lt;-</span> <span class="fu">t</span>(J) <span class="sc">%*%</span> r1</span>
<span id="cb38-54"><a href="evaluation-of-the-custom-code.html#cb38-54" tabindex="-1"></a>    feval <span class="ot">&lt;-</span> feval <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb38-55"><a href="evaluation-of-the-custom-code.html#cb38-55" tabindex="-1"></a></span>
<span id="cb38-56"><a href="evaluation-of-the-custom-code.html#cb38-56" tabindex="-1"></a>    <span class="cf">if</span> (feval <span class="sc">==</span> maxfev) {</span>
<span id="cb38-57"><a href="evaluation-of-the-custom-code.html#cb38-57" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">&quot;Number of function evaluations reached: &quot;</span>, feval, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb38-58"><a href="evaluation-of-the-custom-code.html#cb38-58" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb38-59"><a href="evaluation-of-the-custom-code.html#cb38-59" tabindex="-1"></a>    }</span>
<span id="cb38-60"><a href="evaluation-of-the-custom-code.html#cb38-60" tabindex="-1"></a></span>
<span id="cb38-61"><a href="evaluation-of-the-custom-code.html#cb38-61" tabindex="-1"></a>    JTJ <span class="ot">&lt;-</span> <span class="fu">t</span>(J) <span class="sc">%*%</span> J <span class="sc">+</span> mu <span class="sc">*</span> <span class="fu">diag</span>(<span class="fu">ncol</span>(J))  </span>
<span id="cb38-62"><a href="evaluation-of-the-custom-code.html#cb38-62" tabindex="-1"></a>    QR <span class="ot">&lt;-</span> <span class="fu">qr</span>(JTJ)</span>
<span id="cb38-63"><a href="evaluation-of-the-custom-code.html#cb38-63" tabindex="-1"></a>    </span>
<span id="cb38-64"><a href="evaluation-of-the-custom-code.html#cb38-64" tabindex="-1"></a>    damp <span class="ot">&lt;-</span> mu <span class="sc">*</span> <span class="fu">diag</span>(<span class="fu">ncol</span>(JTJ))</span>
<span id="cb38-65"><a href="evaluation-of-the-custom-code.html#cb38-65" tabindex="-1"></a></span>
<span id="cb38-66"><a href="evaluation-of-the-custom-code.html#cb38-66" tabindex="-1"></a>    JTJ.inv <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb38-67"><a href="evaluation-of-the-custom-code.html#cb38-67" tabindex="-1"></a>      <span class="fu">qr.solve</span>(JTJ)</span>
<span id="cb38-68"><a href="evaluation-of-the-custom-code.html#cb38-68" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb38-69"><a href="evaluation-of-the-custom-code.html#cb38-69" tabindex="-1"></a>      <span class="fu">ginv</span>(JTJ)</span>
<span id="cb38-70"><a href="evaluation-of-the-custom-code.html#cb38-70" tabindex="-1"></a>    })</span>
<span id="cb38-71"><a href="evaluation-of-the-custom-code.html#cb38-71" tabindex="-1"></a></span>
<span id="cb38-72"><a href="evaluation-of-the-custom-code.html#cb38-72" tabindex="-1"></a>    dk <span class="ot">&lt;-</span> JTJ.inv <span class="sc">%*%</span> Jr</span>
<span id="cb38-73"><a href="evaluation-of-the-custom-code.html#cb38-73" tabindex="-1"></a>    w1 <span class="ot">&lt;-</span> w <span class="sc">+</span> dk</span>
<span id="cb38-74"><a href="evaluation-of-the-custom-code.html#cb38-74" tabindex="-1"></a>    </span>
<span id="cb38-75"><a href="evaluation-of-the-custom-code.html#cb38-75" tabindex="-1"></a>    chisq.new <span class="ot">&lt;-</span> <span class="fu">chi.squre.fn</span>(w1)</span>
<span id="cb38-76"><a href="evaluation-of-the-custom-code.html#cb38-76" tabindex="-1"></a>    actual.relative.reduction <span class="ot">&lt;-</span> <span class="fu">abs</span>( previous.chisq <span class="sc">-</span> chisq.new) <span class="sc">/</span>  previous.chisq</span>
<span id="cb38-77"><a href="evaluation-of-the-custom-code.html#cb38-77" tabindex="-1"></a>    predicted.relative.reduction <span class="ot">&lt;-</span> p <span class="ot">&lt;-</span>  (previous.chisq <span class="sc">-</span> chisq.new) <span class="sc">/</span> <span class="fu">abs</span>(<span class="fu">t</span>(dk) <span class="sc">%*%</span> (damp <span class="sc">%*%</span> dk <span class="sc">+</span> Jr))</span>
<span id="cb38-78"><a href="evaluation-of-the-custom-code.html#cb38-78" tabindex="-1"></a>    relative.error <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(w1 <span class="sc">-</span> w.previous)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">abs</span>(w.previous))</span>
<span id="cb38-79"><a href="evaluation-of-the-custom-code.html#cb38-79" tabindex="-1"></a>    cosine.angles <span class="ot">&lt;-</span> <span class="fu">calculate.cosine.angles</span>(y, w)</span>
<span id="cb38-80"><a href="evaluation-of-the-custom-code.html#cb38-80" tabindex="-1"></a>  </span>
<span id="cb38-81"><a href="evaluation-of-the-custom-code.html#cb38-81" tabindex="-1"></a>    convergence <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb38-82"><a href="evaluation-of-the-custom-code.html#cb38-82" tabindex="-1"></a>      <span class="cf">if</span> (actual.relative.reduction <span class="sc">&lt;</span> ftol <span class="sc">&amp;</span> p <span class="sc">&lt;</span> ftol) {</span>
<span id="cb38-83"><a href="evaluation-of-the-custom-code.html#cb38-83" tabindex="-1"></a>        convergence.result <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;ARD:&quot;</span>, actual.relative.reduction, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="st">&quot;PRD:&quot;</span>, p )</span>
<span id="cb38-84"><a href="evaluation-of-the-custom-code.html#cb38-84" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (relative.error <span class="sc">&lt;</span> ptol) {</span>
<span id="cb38-85"><a href="evaluation-of-the-custom-code.html#cb38-85" tabindex="-1"></a>        convergence.result <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;RE:&quot;</span>, relative.error)</span>
<span id="cb38-86"><a href="evaluation-of-the-custom-code.html#cb38-86" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb38-87"><a href="evaluation-of-the-custom-code.html#cb38-87" tabindex="-1"></a>        convergence.result <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;CA:&quot;</span>, cosine.angles)</span>
<span id="cb38-88"><a href="evaluation-of-the-custom-code.html#cb38-88" tabindex="-1"></a>      } </span>
<span id="cb38-89"><a href="evaluation-of-the-custom-code.html#cb38-89" tabindex="-1"></a>    }</span>
<span id="cb38-90"><a href="evaluation-of-the-custom-code.html#cb38-90" tabindex="-1"></a>    </span>
<span id="cb38-91"><a href="evaluation-of-the-custom-code.html#cb38-91" tabindex="-1"></a>    convergence.result <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb38-92"><a href="evaluation-of-the-custom-code.html#cb38-92" tabindex="-1"></a>    </span>
<span id="cb38-93"><a href="evaluation-of-the-custom-code.html#cb38-93" tabindex="-1"></a>    <span class="cf">if</span> (actual.relative.reduction <span class="sc">&lt;</span> ftol <span class="sc">&amp;</span> p <span class="sc">&lt;</span> ftol <span class="sc">||</span> relative.error <span class="sc">&lt;</span> ptol <span class="sc">||</span> <span class="fu">max</span>(<span class="fu">abs</span>(cosine.angles)) <span class="sc">&lt;</span> gtol ) {</span>
<span id="cb38-94"><a href="evaluation-of-the-custom-code.html#cb38-94" tabindex="-1"></a>     convergence.result <span class="ot">&lt;-</span> <span class="fu">convergence</span>()</span>
<span id="cb38-95"><a href="evaluation-of-the-custom-code.html#cb38-95" tabindex="-1"></a>     <span class="cf">break</span> </span>
<span id="cb38-96"><a href="evaluation-of-the-custom-code.html#cb38-96" tabindex="-1"></a>    }</span>
<span id="cb38-97"><a href="evaluation-of-the-custom-code.html#cb38-97" tabindex="-1"></a>    </span>
<span id="cb38-98"><a href="evaluation-of-the-custom-code.html#cb38-98" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb38-99"><a href="evaluation-of-the-custom-code.html#cb38-99" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> <span class="fu">max</span>(mu <span class="sc">/</span> <span class="dv">9</span>, <span class="fl">1e-10</span>)  </span>
<span id="cb38-100"><a href="evaluation-of-the-custom-code.html#cb38-100" tabindex="-1"></a>      w.previous <span class="ot">&lt;-</span> w  </span>
<span id="cb38-101"><a href="evaluation-of-the-custom-code.html#cb38-101" tabindex="-1"></a>      w <span class="ot">&lt;-</span> w1  </span>
<span id="cb38-102"><a href="evaluation-of-the-custom-code.html#cb38-102" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb38-103"><a href="evaluation-of-the-custom-code.html#cb38-103" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> <span class="fu">min</span>(mu <span class="sc">*</span> <span class="dv">11</span>, <span class="fl">1e10</span>)  </span>
<span id="cb38-104"><a href="evaluation-of-the-custom-code.html#cb38-104" tabindex="-1"></a>    }</span>
<span id="cb38-105"><a href="evaluation-of-the-custom-code.html#cb38-105" tabindex="-1"></a></span>
<span id="cb38-106"><a href="evaluation-of-the-custom-code.html#cb38-106" tabindex="-1"></a>    previous.chisq <span class="ot">&lt;-</span> chisq.new  </span>
<span id="cb38-107"><a href="evaluation-of-the-custom-code.html#cb38-107" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span>  </span>
<span id="cb38-108"><a href="evaluation-of-the-custom-code.html#cb38-108" tabindex="-1"></a></span>
<span id="cb38-109"><a href="evaluation-of-the-custom-code.html#cb38-109" tabindex="-1"></a>    <span class="cf">if</span> (k <span class="sc">==</span> maxiter) {</span>
<span id="cb38-110"><a href="evaluation-of-the-custom-code.html#cb38-110" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">&quot;Number of iterations till stop: &quot;</span>, k, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb38-111"><a href="evaluation-of-the-custom-code.html#cb38-111" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb38-112"><a href="evaluation-of-the-custom-code.html#cb38-112" tabindex="-1"></a>    }</span>
<span id="cb38-113"><a href="evaluation-of-the-custom-code.html#cb38-113" tabindex="-1"></a>  }</span>
<span id="cb38-114"><a href="evaluation-of-the-custom-code.html#cb38-114" tabindex="-1"></a></span>
<span id="cb38-115"><a href="evaluation-of-the-custom-code.html#cb38-115" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">parameters =</span> w)  </span>
<span id="cb38-116"><a href="evaluation-of-the-custom-code.html#cb38-116" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb38-117"><a href="evaluation-of-the-custom-code.html#cb38-117" tabindex="-1"></a>}</span>
<span id="cb38-118"><a href="evaluation-of-the-custom-code.html#cb38-118" tabindex="-1"></a></span>
<span id="cb38-119"><a href="evaluation-of-the-custom-code.html#cb38-119" tabindex="-1"></a>result.list.mdf <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb38-120"><a href="evaluation-of-the-custom-code.html#cb38-120" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">unique</span>(df_temp<span class="sc">$</span>run)){</span>
<span id="cb38-121"><a href="evaluation-of-the-custom-code.html#cb38-121" tabindex="-1"></a>  w <span class="ot">&lt;-</span> <span class="fu">c</span>(df_start<span class="sc">$</span>Max[df_start<span class="sc">$</span>run<span class="sc">==</span>i],</span>
<span id="cb38-122"><a href="evaluation-of-the-custom-code.html#cb38-122" tabindex="-1"></a>         df_start<span class="sc">$</span>Slope[df_start<span class="sc">$</span>run<span class="sc">==</span>i],</span>
<span id="cb38-123"><a href="evaluation-of-the-custom-code.html#cb38-123" tabindex="-1"></a>         df_start<span class="sc">$</span>C[df_start<span class="sc">$</span>run<span class="sc">==</span>i],</span>
<span id="cb38-124"><a href="evaluation-of-the-custom-code.html#cb38-124" tabindex="-1"></a>         df_start<span class="sc">$</span>Min[df_start<span class="sc">$</span>run<span class="sc">==</span>i],</span>
<span id="cb38-125"><a href="evaluation-of-the-custom-code.html#cb38-125" tabindex="-1"></a>         df_start<span class="sc">$</span>M[df_start<span class="sc">$</span>run<span class="sc">==</span>i])</span>
<span id="cb38-126"><a href="evaluation-of-the-custom-code.html#cb38-126" tabindex="-1"></a>    result.list.mdf[[i]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">LM.custom</span>(w, df_temp, i))</span>
<span id="cb38-127"><a href="evaluation-of-the-custom-code.html#cb38-127" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Number of iterations till stop:  200 
## Number of iterations till stop:  200 
## Number of iterations till stop:  200 
## Number of iterations till stop:  200 
## Number of iterations till stop:  200 
## Number of iterations till stop:  200 
## Number of iterations till stop:  200 
## Number of iterations till stop:  200</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="evaluation-of-the-custom-code.html#cb40-1" tabindex="-1"></a>result.list.mdf <span class="ot">&lt;-</span> result.list.mdf[<span class="fu">lapply</span>(result.list.mdf,length)<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb40-2"><a href="evaluation-of-the-custom-code.html#cb40-2" tabindex="-1"></a>result.list.mdf <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">unlist</span>(result.list.mdf))</span>
<span id="cb40-3"><a href="evaluation-of-the-custom-code.html#cb40-3" tabindex="-1"></a>result.list.mdf <span class="ot">&lt;-</span> <span class="fu">matrix</span>(result.list.mdf, <span class="at">ncol=</span><span class="dv">5</span>,  <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-4"><a href="evaluation-of-the-custom-code.html#cb40-4" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result.list.mdf)</span>
<span id="cb40-5"><a href="evaluation-of-the-custom-code.html#cb40-5" tabindex="-1"></a>parameters<span class="sc">$</span>run <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">101</span>)</span>
<span id="cb40-6"><a href="evaluation-of-the-custom-code.html#cb40-6" tabindex="-1"></a><span class="fu">colnames</span>(parameters) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;w1&quot;</span>, <span class="st">&quot;w2&quot;</span>, <span class="st">&quot;w3&quot;</span>, <span class="st">&quot;w4&quot;</span>, <span class="st">&quot;w5&quot;</span>, <span class="st">&quot;run&quot;</span>)</span></code></pre></div>
<hr />
<p>This code is for <code>nlsLM</code> in R to do the same.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="evaluation-of-the-custom-code.html#cb41-1" tabindex="-1"></a>LM.nlsLM <span class="ot">&lt;-</span> <span class="cf">function</span>(w0, data, run) {</span>
<span id="cb41-2"><a href="evaluation-of-the-custom-code.html#cb41-2" tabindex="-1"></a></span>
<span id="cb41-3"><a href="evaluation-of-the-custom-code.html#cb41-3" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>od[data<span class="sc">$</span>run <span class="sc">==</span> run]</span>
<span id="cb41-4"><a href="evaluation-of-the-custom-code.html#cb41-4" tabindex="-1"></a>  x_data <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>conc)</span>
<span id="cb41-5"><a href="evaluation-of-the-custom-code.html#cb41-5" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x_data)</span>
<span id="cb41-6"><a href="evaluation-of-the-custom-code.html#cb41-6" tabindex="-1"></a>  x_rep <span class="ot">&lt;-</span> <span class="fu">rep</span>(x_data, <span class="dv">2</span>)</span>
<span id="cb41-7"><a href="evaluation-of-the-custom-code.html#cb41-7" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>od[data<span class="sc">$</span>run <span class="sc">==</span> run]</span>
<span id="cb41-8"><a href="evaluation-of-the-custom-code.html#cb41-8" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">unique</span>(data<span class="sc">$</span>conc), <span class="at">od=</span>y)</span>
<span id="cb41-9"><a href="evaluation-of-the-custom-code.html#cb41-9" tabindex="-1"></a>  </span>
<span id="cb41-10"><a href="evaluation-of-the-custom-code.html#cb41-10" tabindex="-1"></a></span>
<span id="cb41-11"><a href="evaluation-of-the-custom-code.html#cb41-11" tabindex="-1"></a>  model_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x, a, b, c, d, e) {</span>
<span id="cb41-12"><a href="evaluation-of-the-custom-code.html#cb41-12" tabindex="-1"></a>    a <span class="sc">+</span> (d <span class="sc">-</span> a) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> (x <span class="sc">/</span> c)<span class="sc">^</span>b)<span class="sc">^</span>e</span>
<span id="cb41-13"><a href="evaluation-of-the-custom-code.html#cb41-13" tabindex="-1"></a>  }</span>
<span id="cb41-14"><a href="evaluation-of-the-custom-code.html#cb41-14" tabindex="-1"></a>  </span>
<span id="cb41-15"><a href="evaluation-of-the-custom-code.html#cb41-15" tabindex="-1"></a></span>
<span id="cb41-16"><a href="evaluation-of-the-custom-code.html#cb41-16" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">nlsLM</span>(y <span class="sc">~</span> <span class="fu">model_fn</span>(x, a, b, c, d, e), <span class="at">data =</span> df_temp,</span>
<span id="cb41-17"><a href="evaluation-of-the-custom-code.html#cb41-17" tabindex="-1"></a>               <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> w0[<span class="dv">1</span>], <span class="at">b =</span> w0[<span class="dv">2</span>], <span class="at">c =</span> w0[<span class="dv">3</span>], <span class="at">d =</span> w0[<span class="dv">4</span>], <span class="at">e =</span> w0[<span class="dv">5</span>]),</span>
<span id="cb41-18"><a href="evaluation-of-the-custom-code.html#cb41-18" tabindex="-1"></a>               <span class="at">control =</span> <span class="fu">nls.lm.control</span>(<span class="at">maxiter =</span> <span class="dv">1000</span>, <span class="at">ftol =</span> <span class="fl">1e-6</span>)))</span>
<span id="cb41-19"><a href="evaluation-of-the-custom-code.html#cb41-19" tabindex="-1"></a>  </span>
<span id="cb41-20"><a href="evaluation-of-the-custom-code.html#cb41-20" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit)</span>
<span id="cb41-21"><a href="evaluation-of-the-custom-code.html#cb41-21" tabindex="-1"></a>  </span>
<span id="cb41-22"><a href="evaluation-of-the-custom-code.html#cb41-22" tabindex="-1"></a>}</span>
<span id="cb41-23"><a href="evaluation-of-the-custom-code.html#cb41-23" tabindex="-1"></a></span>
<span id="cb41-24"><a href="evaluation-of-the-custom-code.html#cb41-24" tabindex="-1"></a>result.list.nlsLM <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb41-25"><a href="evaluation-of-the-custom-code.html#cb41-25" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">unique</span>(df_temp<span class="sc">$</span>run)){</span>
<span id="cb41-26"><a href="evaluation-of-the-custom-code.html#cb41-26" tabindex="-1"></a>  w <span class="ot">&lt;-</span> <span class="fu">c</span>(df_start<span class="sc">$</span>Max[df_start<span class="sc">$</span>run<span class="sc">==</span>i],</span>
<span id="cb41-27"><a href="evaluation-of-the-custom-code.html#cb41-27" tabindex="-1"></a>         df_start<span class="sc">$</span>Slope[df_start<span class="sc">$</span>run<span class="sc">==</span>i],</span>
<span id="cb41-28"><a href="evaluation-of-the-custom-code.html#cb41-28" tabindex="-1"></a>         df_start<span class="sc">$</span>C[df_start<span class="sc">$</span>run<span class="sc">==</span>i],</span>
<span id="cb41-29"><a href="evaluation-of-the-custom-code.html#cb41-29" tabindex="-1"></a>         df_start<span class="sc">$</span>Min[df_start<span class="sc">$</span>run<span class="sc">==</span>i],</span>
<span id="cb41-30"><a href="evaluation-of-the-custom-code.html#cb41-30" tabindex="-1"></a>         df_start<span class="sc">$</span>M[df_start<span class="sc">$</span>run<span class="sc">==</span>i])</span>
<span id="cb41-31"><a href="evaluation-of-the-custom-code.html#cb41-31" tabindex="-1"></a>  result.list.nlsLM[[i]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">LM.nlsLM</span>(w, df_temp, i))</span>
<span id="cb41-32"><a href="evaluation-of-the-custom-code.html#cb41-32" tabindex="-1"></a>}</span>
<span id="cb41-33"><a href="evaluation-of-the-custom-code.html#cb41-33" tabindex="-1"></a></span>
<span id="cb41-34"><a href="evaluation-of-the-custom-code.html#cb41-34" tabindex="-1"></a>result.list.nlsLM <span class="ot">&lt;-</span> result.list.nlsLM[<span class="fu">lapply</span>(result.list.nlsLM,length)<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb41-35"><a href="evaluation-of-the-custom-code.html#cb41-35" tabindex="-1"></a>result.list.nlsLM <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">unlist</span>(result.list.nlsLM), <span class="at">ncol=</span><span class="dv">5</span>,  <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-36"><a href="evaluation-of-the-custom-code.html#cb41-36" tabindex="-1"></a></span>
<span id="cb41-37"><a href="evaluation-of-the-custom-code.html#cb41-37" tabindex="-1"></a></span>
<span id="cb41-38"><a href="evaluation-of-the-custom-code.html#cb41-38" tabindex="-1"></a>parameters<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result.list.nlsLM)</span>
<span id="cb41-39"><a href="evaluation-of-the-custom-code.html#cb41-39" tabindex="-1"></a>parameters<span class="fl">.2</span><span class="sc">$</span>run <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">101</span>)</span>
<span id="cb41-40"><a href="evaluation-of-the-custom-code.html#cb41-40" tabindex="-1"></a><span class="fu">colnames</span>(parameters<span class="fl">.2</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;w1&quot;</span>, <span class="st">&quot;w2&quot;</span>, <span class="st">&quot;w3&quot;</span>, <span class="st">&quot;w4&quot;</span>, <span class="st">&quot;w5&quot;</span>, <span class="st">&quot;run&quot;</span>)</span></code></pre></div>
<hr />
<p>Next, using those parameters and assay signal, we’ll back-calculate the concentrations of all calibration standard samples. For this, we need the inverse function of the 5 PL curve model:</p>
<p><span class="math display">\[
\text{Concentration} = C \cdot \left( \left( \frac{A - D}{od - D} \right)^{\frac{1}{G}} - 1 \right)^{\frac{1}{B}}
\]</span></p>
<p>Where,</p>
<ul>
<li>D: Infinite X asymptote, W1</li>
<li>B: Slope/Hill, W2</li>
<li>C: Inflection point, W3</li>
<li>A: Small X asymptote, W4</li>
<li>G: asymmetric factor, W5</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="evaluation-of-the-custom-code.html#cb42-1" tabindex="-1"></a>df_temp[, <span class="st">&quot;xhat1&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="do">## for my code</span></span>
<span id="cb42-2"><a href="evaluation-of-the-custom-code.html#cb42-2" tabindex="-1"></a>df_temp[, <span class="st">&quot;xhat2&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="do">## for nlsLM</span></span>
<span id="cb42-3"><a href="evaluation-of-the-custom-code.html#cb42-3" tabindex="-1"></a></span>
<span id="cb42-4"><a href="evaluation-of-the-custom-code.html#cb42-4" tabindex="-1"></a>x.hat <span class="ot">&lt;-</span> <span class="cf">function</span>(od, w){</span>
<span id="cb42-5"><a href="evaluation-of-the-custom-code.html#cb42-5" tabindex="-1"></a>  xhat <span class="ot">&lt;-</span> w[<span class="dv">3</span>] <span class="sc">*</span> (((w[<span class="dv">4</span>] <span class="sc">-</span> w[<span class="dv">1</span>])<span class="sc">/</span>(od <span class="sc">-</span> w[<span class="dv">1</span>]))<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>w[<span class="dv">5</span>]) <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> w[<span class="dv">2</span>]) </span>
<span id="cb42-6"><a href="evaluation-of-the-custom-code.html#cb42-6" tabindex="-1"></a>  <span class="fu">return</span>(xhat) </span>
<span id="cb42-7"><a href="evaluation-of-the-custom-code.html#cb42-7" tabindex="-1"></a>}</span>
<span id="cb42-8"><a href="evaluation-of-the-custom-code.html#cb42-8" tabindex="-1"></a></span>
<span id="cb42-9"><a href="evaluation-of-the-custom-code.html#cb42-9" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_temp)){</span>
<span id="cb42-10"><a href="evaluation-of-the-custom-code.html#cb42-10" tabindex="-1"></a>    od <span class="ot">&lt;-</span> df_temp[i, <span class="dv">4</span>]</span>
<span id="cb42-11"><a href="evaluation-of-the-custom-code.html#cb42-11" tabindex="-1"></a>    w <span class="ot">&lt;-</span>  <span class="fu">as.vector</span>(<span class="fu">unlist</span>(parameters[parameters<span class="sc">$</span>run <span class="sc">==</span> df_temp[i, <span class="dv">5</span>], <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)]))</span>
<span id="cb42-12"><a href="evaluation-of-the-custom-code.html#cb42-12" tabindex="-1"></a>    df_temp[i, <span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="fu">x.hat</span>(od, w)</span>
<span id="cb42-13"><a href="evaluation-of-the-custom-code.html#cb42-13" tabindex="-1"></a>}</span>
<span id="cb42-14"><a href="evaluation-of-the-custom-code.html#cb42-14" tabindex="-1"></a></span>
<span id="cb42-15"><a href="evaluation-of-the-custom-code.html#cb42-15" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_temp)){</span>
<span id="cb42-16"><a href="evaluation-of-the-custom-code.html#cb42-16" tabindex="-1"></a>    od <span class="ot">&lt;-</span> df_temp[i, <span class="dv">4</span>]</span>
<span id="cb42-17"><a href="evaluation-of-the-custom-code.html#cb42-17" tabindex="-1"></a>    w <span class="ot">&lt;-</span>  <span class="fu">as.vector</span>(<span class="fu">unlist</span>(parameters<span class="fl">.2</span>[parameters<span class="fl">.2</span><span class="sc">$</span>run <span class="sc">==</span> df_temp[i, <span class="dv">5</span>], <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)]))</span>
<span id="cb42-18"><a href="evaluation-of-the-custom-code.html#cb42-18" tabindex="-1"></a>    df_temp[i, <span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="fu">x.hat</span>(od, w)</span>
<span id="cb42-19"><a href="evaluation-of-the-custom-code.html#cb42-19" tabindex="-1"></a>}</span>
<span id="cb42-20"><a href="evaluation-of-the-custom-code.html#cb42-20" tabindex="-1"></a></span>
<span id="cb42-21"><a href="evaluation-of-the-custom-code.html#cb42-21" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">bias1 =</span> <span class="fu">round</span>((xhat1 <span class="sc">-</span> conc)<span class="sc">/</span>conc <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb42-22"><a href="evaluation-of-the-custom-code.html#cb42-22" tabindex="-1"></a>                              <span class="at">bias2 =</span> <span class="fu">round</span>((xhat2 <span class="sc">-</span> conc)<span class="sc">/</span>conc <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>))</span></code></pre></div>
<hr />
<p>To confirm the comparison results, we reconstruct the %Bias data as follows:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="evaluation-of-the-custom-code.html#cb43-1" tabindex="-1"></a>bias<span class="fl">.1</span> <span class="ot">&lt;-</span> df_temp[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">8</span>)]</span>
<span id="cb43-2"><a href="evaluation-of-the-custom-code.html#cb43-2" tabindex="-1"></a>bias<span class="fl">.2</span> <span class="ot">&lt;-</span> df_temp[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>)]</span>
<span id="cb43-3"><a href="evaluation-of-the-custom-code.html#cb43-3" tabindex="-1"></a><span class="fu">colnames</span>(bias<span class="fl">.1</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;calb&quot;</span>, <span class="st">&quot;conc&quot;</span>, <span class="st">&quot;rep&quot;</span>, <span class="st">&quot;od&quot;</span>, <span class="st">&quot;run&quot;</span>, <span class="st">&quot;xhat&quot;</span>, <span class="st">&quot;bias&quot;</span>)</span>
<span id="cb43-4"><a href="evaluation-of-the-custom-code.html#cb43-4" tabindex="-1"></a><span class="fu">colnames</span>(bias<span class="fl">.2</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;calb&quot;</span>, <span class="st">&quot;conc&quot;</span>, <span class="st">&quot;rep&quot;</span>, <span class="st">&quot;od&quot;</span>, <span class="st">&quot;run&quot;</span>, <span class="st">&quot;xhat&quot;</span>, <span class="st">&quot;bias&quot;</span>)</span>
<span id="cb43-5"><a href="evaluation-of-the-custom-code.html#cb43-5" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="fu">rbind</span>(bias<span class="fl">.1</span>, bias<span class="fl">.2</span>)</span>
<span id="cb43-6"><a href="evaluation-of-the-custom-code.html#cb43-6" tabindex="-1"></a>bias<span class="sc">$</span>code <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="dv">2</span>, <span class="fu">nrow</span>(bias)<span class="sc">/</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;My code&quot;</span>, <span class="st">&quot;nlsLM&quot;</span>))</span></code></pre></div>
<p>Finally, we visualize the %Bias of all calibration standard samples as follows:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="evaluation-of-the-custom-code.html#cb44-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">03</span>)</span>
<span id="cb44-2"><a href="evaluation-of-the-custom-code.html#cb44-2" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bias, <span class="fu">aes</span>(<span class="fu">log</span>(conc), bias, <span class="at">col=</span>code)) <span class="sc">+</span></span>
<span id="cb44-3"><a href="evaluation-of-the-custom-code.html#cb44-3" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span>.<span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb44-4"><a href="evaluation-of-the-custom-code.html#cb44-4" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#1226A3&quot;</span>, <span class="st">&quot;#FF0000&quot;</span>)) <span class="sc">+</span></span>
<span id="cb44-5"><a href="evaluation-of-the-custom-code.html#cb44-5" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">5</span>), <span class="fu">log</span>(<span class="dv">10</span>), <span class="fu">log</span>(<span class="dv">15</span>), <span class="fu">log</span>(<span class="dv">30</span>), <span class="fu">log</span>(<span class="dv">60</span>), <span class="fu">log</span>(<span class="dv">80</span>), <span class="fu">log</span>(<span class="dv">100</span>), <span class="fu">log</span>(<span class="dv">150</span>), <span class="fu">log</span>(<span class="dv">200</span>), <span class="fu">log</span>(<span class="dv">400</span>), <span class="fu">log</span>(<span class="dv">800</span>), <span class="fu">log</span>(<span class="dv">1600</span>)), </span>
<span id="cb44-6"><a href="evaluation-of-the-custom-code.html#cb44-6" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;60&quot;</span>, <span class="st">&quot;80&quot;</span>, <span class="st">&quot;100&quot;</span>, <span class="st">&quot;150&quot;</span>, <span class="st">&quot;200&quot;</span>, <span class="st">&quot;400&quot;</span>, <span class="st">&quot;800&quot;</span>, <span class="st">&quot;1600&quot;</span>)) <span class="sc">+</span></span>
<span id="cb44-7"><a href="evaluation-of-the-custom-code.html#cb44-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb44-8"><a href="evaluation-of-the-custom-code.html#cb44-8" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb44-9"><a href="evaluation-of-the-custom-code.html#cb44-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb44-10"><a href="evaluation-of-the-custom-code.html#cb44-10" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Bias(%)&quot;</span>)<span class="sc">+</span></span>
<span id="cb44-11"><a href="evaluation-of-the-custom-code.html#cb44-11" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Concentration (ng/mL) in log sacle&quot;</span>)</span>
<span id="cb44-12"><a href="evaluation-of-the-custom-code.html#cb44-12" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">&quot;result&quot;</span>,<span class="st">&quot;g1.png&quot;</span>), <span class="at">plot=</span>g1, <span class="at">dpi=</span><span class="dv">300</span>)</span></code></pre></div>
<pre><code>## Saving 7 x 7 in image</code></pre>
<p><img src="result/g1.png" /><!-- --></p>
<hr />
<p>Most of the points (the %Bias) overlap closely, indicating that the results are very similar. Only a few points show significant <strong>vertical differences</strong>, even considering the use of <code>geom_jitter</code><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, but these are minor and do not affect the overall conclusion. If we want to compare the parameters estimation results and %Bias results of a specific run, first specify a run we want as follows:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="evaluation-of-the-custom-code.html#cb46-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2</span></span></code></pre></div>
<p>And do as follows:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="evaluation-of-the-custom-code.html#cb47-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">list</span>(parameters[parameters<span class="sc">$</span>run <span class="sc">==</span>n, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)]))</span>
<span id="cb47-2"><a href="evaluation-of-the-custom-code.html#cb47-2" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">list</span>(parameters<span class="fl">.2</span>[parameters<span class="fl">.2</span><span class="sc">$</span>run <span class="sc">==</span>n,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) ]))</span>
<span id="cb47-3"><a href="evaluation-of-the-custom-code.html#cb47-3" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">list</span>(bias<span class="fl">.1</span><span class="sc">$</span>bias[bias<span class="fl">.1</span><span class="sc">$</span>run <span class="sc">==</span> n]))</span>
<span id="cb47-4"><a href="evaluation-of-the-custom-code.html#cb47-4" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">list</span>(bias<span class="fl">.2</span><span class="sc">$</span>bias[bias<span class="fl">.2</span><span class="sc">$</span>run <span class="sc">==</span> n]))</span>
<span id="cb47-5"><a href="evaluation-of-the-custom-code.html#cb47-5" tabindex="-1"></a></span>
<span id="cb47-6"><a href="evaluation-of-the-custom-code.html#cb47-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The custom code parameter result:&quot;</span> , p1, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb47-7"><a href="evaluation-of-the-custom-code.html#cb47-7" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The nlsLM in R parameter  result:&quot;</span> , p2, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb47-8"><a href="evaluation-of-the-custom-code.html#cb47-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The custom code %Bias result:&quot;</span> , b1, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb47-9"><a href="evaluation-of-the-custom-code.html#cb47-9" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The nlsLM in R %Bias  result:&quot;</span> , b2)</span></code></pre></div>
<p>And the result will be shown up:</p>
<pre><code>## The custom code parameter result: 6.589187 1.323836 193.6181 0.01556511 0.237396</code></pre>
<pre><code>## The nlsLM in R parameter  result: 6.58917 1.323835 193.6187 0.01556504 0.2373973</code></pre>
<pre><code>## The custom code %Bias result: 73.07 -17.99 -5.66 -0.6 3.78 1.47 2.19 2.33 -0.67 -2.17 7.4 -6.25 55.9 -24.51 -9.5 1.44 -3.48 -5.19 2 -2.22 0.38 1.47 -6.24 6.54</code></pre>
<pre><code>## The nlsLM in R %Bias  result: 73.07 -17.99 -5.66 -0.6 3.78 1.47 2.19 2.33 -0.67 -2.17 7.4 -6.25 55.9 -24.51 -9.5 1.44 -3.48 -5.19 2 -2.22 0.38 1.47 -6.24 6.54</code></pre>
<p>For visualization of the %Bias, do as follows (the grey area indicates quantification range and acceptable range of the %Bias) :</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="evaluation-of-the-custom-code.html#cb52-1" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bias[bias<span class="sc">$</span>run<span class="sc">==</span>n,], <span class="fu">aes</span>(<span class="fu">log</span>(conc), bias, <span class="at">col=</span>code)) <span class="sc">+</span></span>
<span id="cb52-2"><a href="evaluation-of-the-custom-code.html#cb52-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span>.<span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb52-3"><a href="evaluation-of-the-custom-code.html#cb52-3" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#1226A3&quot;</span>, <span class="st">&quot;#FF0000&quot;</span>)) <span class="sc">+</span></span>
<span id="cb52-4"><a href="evaluation-of-the-custom-code.html#cb52-4" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">5</span>), <span class="fu">log</span>(<span class="dv">10</span>), <span class="fu">log</span>(<span class="dv">15</span>), <span class="fu">log</span>(<span class="dv">30</span>), <span class="fu">log</span>(<span class="dv">60</span>), <span class="fu">log</span>(<span class="dv">80</span>), <span class="fu">log</span>(<span class="dv">100</span>), <span class="fu">log</span>(<span class="dv">150</span>), <span class="fu">log</span>(<span class="dv">200</span>), <span class="fu">log</span>(<span class="dv">400</span>), <span class="fu">log</span>(<span class="dv">800</span>), <span class="fu">log</span>(<span class="dv">1600</span>)), </span>
<span id="cb52-5"><a href="evaluation-of-the-custom-code.html#cb52-5" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;60&quot;</span>, <span class="st">&quot;80&quot;</span>, <span class="st">&quot;100&quot;</span>, <span class="st">&quot;150&quot;</span>, <span class="st">&quot;200&quot;</span>, <span class="st">&quot;400&quot;</span>, <span class="st">&quot;800&quot;</span>, <span class="st">&quot;1600&quot;</span>)) <span class="sc">+</span></span>
<span id="cb52-6"><a href="evaluation-of-the-custom-code.html#cb52-6" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb52-7"><a href="evaluation-of-the-custom-code.html#cb52-7" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb52-8"><a href="evaluation-of-the-custom-code.html#cb52-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb52-9"><a href="evaluation-of-the-custom-code.html#cb52-9" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">log</span>(<span class="dv">12</span>), <span class="at">xmax=</span><span class="fu">log</span>(<span class="dv">250</span>),</span>
<span id="cb52-10"><a href="evaluation-of-the-custom-code.html#cb52-10" tabindex="-1"></a>                <span class="at">ymin=</span><span class="sc">-</span><span class="dv">20</span>, <span class="at">ymax=</span><span class="dv">20</span>), <span class="at">fill=</span> <span class="st">&quot;grey&quot;</span>, <span class="at">alpha =</span>.<span class="dv">01</span>, <span class="at">color=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb52-11"><a href="evaluation-of-the-custom-code.html#cb52-11" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Bias(%)&quot;</span>)<span class="sc">+</span></span>
<span id="cb52-12"><a href="evaluation-of-the-custom-code.html#cb52-12" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Concentration (ng/mL) in log sacle&quot;</span>)</span>
<span id="cb52-13"><a href="evaluation-of-the-custom-code.html#cb52-13" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">&quot;result&quot;</span>, <span class="st">&quot;g2.png&quot;</span>), <span class="at">plot=</span> g2, <span class="at">dpi=</span><span class="dv">300</span>)</span></code></pre></div>
<pre><code>## Saving 7 x 7 in image</code></pre>
<p><img src="result/g2.png" /><!-- --></p>
<hr />
<p>Here’s a another result:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="evaluation-of-the-custom-code.html#cb54-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">74</span></span>
<span id="cb54-2"><a href="evaluation-of-the-custom-code.html#cb54-2" tabindex="-1"></a></span>
<span id="cb54-3"><a href="evaluation-of-the-custom-code.html#cb54-3" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">list</span>(parameters[parameters<span class="sc">$</span>run <span class="sc">==</span>n, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)]))</span>
<span id="cb54-4"><a href="evaluation-of-the-custom-code.html#cb54-4" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">list</span>(parameters<span class="fl">.2</span>[parameters<span class="fl">.2</span><span class="sc">$</span>run <span class="sc">==</span>n,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) ]))</span>
<span id="cb54-5"><a href="evaluation-of-the-custom-code.html#cb54-5" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">list</span>(bias<span class="fl">.1</span><span class="sc">$</span>bias[bias<span class="fl">.1</span><span class="sc">$</span>run <span class="sc">==</span> n]))</span>
<span id="cb54-6"><a href="evaluation-of-the-custom-code.html#cb54-6" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">list</span>(bias<span class="fl">.2</span><span class="sc">$</span>bias[bias<span class="fl">.2</span><span class="sc">$</span>run <span class="sc">==</span> n]))</span>
<span id="cb54-7"><a href="evaluation-of-the-custom-code.html#cb54-7" tabindex="-1"></a></span>
<span id="cb54-8"><a href="evaluation-of-the-custom-code.html#cb54-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The custom code parameter result:&quot;</span> , p1, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb54-9"><a href="evaluation-of-the-custom-code.html#cb54-9" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The nlsLM in R parameter  result:&quot;</span> , p2, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb54-10"><a href="evaluation-of-the-custom-code.html#cb54-10" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The custom code %Bias result:&quot;</span> , b1, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb54-11"><a href="evaluation-of-the-custom-code.html#cb54-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The nlsLM in R %Bias  result:&quot;</span> , b2)</span></code></pre></div>
<pre><code>## The custom code parameter result: 5.491253 1.046752 273.3658 -0.01495246 0.2559358</code></pre>
<pre><code>## The nlsLM in R parameter  result: 6.812359 1.078459 224.6647 -0.01205867 0.1744507</code></pre>
<pre><code>## The custom code %Bias result: 40.01 9.35 -6.36 -3.81 -1.6 -4.69 -1.8 1.26 -1.02 -5.45 5.88 4.28 36.82 3.68 -9.85 -12.56 -0.04 1.89 -1.03 10.15 3.52 -2.94 -1.32 -5.02</code></pre>
<pre><code>## The nlsLM in R %Bias  result: 36.4 9.05 -5.99 -2.93 -1.15 -4.46 -1.76 1.05 -1.28 -5.56 6.16 4.11 33.06 3.19 -9.56 -11.75 0.4 2.07 -1 9.9 3.24 -3.04 -1.07 -5.03</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="evaluation-of-the-custom-code.html#cb59-1" tabindex="-1"></a>g3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bias[bias<span class="sc">$</span>run<span class="sc">==</span>n,], <span class="fu">aes</span>(<span class="fu">log</span>(conc), bias, <span class="at">col=</span>code)) <span class="sc">+</span></span>
<span id="cb59-2"><a href="evaluation-of-the-custom-code.html#cb59-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span>.<span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb59-3"><a href="evaluation-of-the-custom-code.html#cb59-3" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#1226A3&quot;</span>, <span class="st">&quot;#FF0000&quot;</span>)) <span class="sc">+</span></span>
<span id="cb59-4"><a href="evaluation-of-the-custom-code.html#cb59-4" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">5</span>), <span class="fu">log</span>(<span class="dv">10</span>), <span class="fu">log</span>(<span class="dv">15</span>), <span class="fu">log</span>(<span class="dv">30</span>), <span class="fu">log</span>(<span class="dv">60</span>), <span class="fu">log</span>(<span class="dv">80</span>), <span class="fu">log</span>(<span class="dv">100</span>), <span class="fu">log</span>(<span class="dv">150</span>), <span class="fu">log</span>(<span class="dv">200</span>), <span class="fu">log</span>(<span class="dv">400</span>), <span class="fu">log</span>(<span class="dv">800</span>), <span class="fu">log</span>(<span class="dv">1600</span>)), </span>
<span id="cb59-5"><a href="evaluation-of-the-custom-code.html#cb59-5" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;60&quot;</span>, <span class="st">&quot;80&quot;</span>, <span class="st">&quot;100&quot;</span>, <span class="st">&quot;150&quot;</span>, <span class="st">&quot;200&quot;</span>, <span class="st">&quot;400&quot;</span>, <span class="st">&quot;800&quot;</span>, <span class="st">&quot;1600&quot;</span>)) <span class="sc">+</span></span>
<span id="cb59-6"><a href="evaluation-of-the-custom-code.html#cb59-6" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-7"><a href="evaluation-of-the-custom-code.html#cb59-7" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb59-8"><a href="evaluation-of-the-custom-code.html#cb59-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb59-9"><a href="evaluation-of-the-custom-code.html#cb59-9" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">log</span>(<span class="dv">12</span>), <span class="at">xmax=</span><span class="fu">log</span>(<span class="dv">250</span>),</span>
<span id="cb59-10"><a href="evaluation-of-the-custom-code.html#cb59-10" tabindex="-1"></a>                <span class="at">ymin=</span><span class="sc">-</span><span class="dv">20</span>, <span class="at">ymax=</span><span class="dv">20</span>), <span class="at">fill=</span> <span class="st">&quot;grey&quot;</span>, <span class="at">alpha =</span>.<span class="dv">01</span>, <span class="at">color=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb59-11"><a href="evaluation-of-the-custom-code.html#cb59-11" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Bias(%)&quot;</span>)<span class="sc">+</span></span>
<span id="cb59-12"><a href="evaluation-of-the-custom-code.html#cb59-12" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Concentration (ng/mL) in log sacle&quot;</span>)</span>
<span id="cb59-13"><a href="evaluation-of-the-custom-code.html#cb59-13" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">&quot;result&quot;</span>,<span class="st">&quot;g3.png&quot;</span>),<span class="at">plot=</span>g3, <span class="at">dpi=</span><span class="dv">300</span>)</span></code></pre></div>
<pre><code>## Saving 7 x 7 in image</code></pre>
<p><img src="result/g3.png" /><!-- --></p>
<hr />
<p>The parameter results were slightly different and so were the %Bias results. However, the discrepancy between the %Bias results were small and the %Bias of all calibration standard curve samples within the quantification range (from LLOQ to ULOQ) met the acceptance criteria for accuracy.</p>
<hr />
<p>Finally, this is the last example of comparison of the %Bias results. The new %Bias results are obtained by Watson LIMS. Watson LIMS also provides a wide range of algorithm for non-linear regression and for the optimization of parameters and computation of %Bias, I chosen <strong>Marquardt</strong> algorithm that is the LM algorithm. As can be seen below, most of points overlap closely.</p>
<p><img src="result/all.png" /><!-- --></p>

</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>The <code>geom_jitter</code> function is used to add a small random variation to the position of data points, shifting them both vertically and horizontally. This helps preventing the data from overlapping when plotted, making them more distinguishable, especially when multiple data points have the same or very similar values.<a href="evaluation-of-the-custom-code.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="applying-the-lm-algorithm-to-lba-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="closing-remarks.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/USERNAME/REPO/edit/BRANCH/07-5PL-fitting2.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.HTML"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
